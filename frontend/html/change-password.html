<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ether Lottery - ƒê·ªïi M·∫≠t Kh·∫©u</title>
    <link rel="stylesheet" href="../css/variables.css?v=6" />
    <link rel="stylesheet" href="../css/base.css?v=6" />
    <link rel="stylesheet" href="../css/change-password.css?v=6" />
    <script src="../js/theme.js?v=6"></script>
  </head>
  <body>
    <div class="password-container">
      <div class="password-card">
        <div class="card-header">
          <div class="logo-section">
            <img src="../icon/logo.png" alt="Logo" class="logo-img" />
            <h1>Ether Lottery</h1>
          </div>
          <h2>ƒê·ªïi M·∫≠t Kh·∫©u</h2>
          <p>Vui l√≤ng nh·∫≠p th√¥ng tin ƒë·ªÉ thay ƒë·ªïi m·∫≠t kh·∫©u c·ªßa b·∫°n</p>
        </div>

        <form class="password-form" id="changePasswordForm">
          <div class="input-group">
            <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
            <div class="input-wrapper">
              <span class="input-icon">üîí</span>
              <input
                type="password"
                id="current-password"
                placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
                required
              />
            </div>
          </div>

          <div class="input-group">
            <label>M·∫≠t kh·∫©u m·ªõi</label>
            <div class="input-wrapper">
              <span class="input-icon">üîê</span>
              <input
                type="password"
                id="new-password"
                placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                required
              />
            </div>
          </div>

          <div class="input-group">
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
            <div class="input-wrapper">
              <span class="input-icon">‚úì</span>
              <input
                type="password"
                id="confirm-password"
                placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                required
              />
            </div>
          </div>

          <div class="requirements-box">
            <div class="requirements-title">Y√™u c·∫ßu m·∫≠t kh·∫©u:</div>
            <div class="requirements-list">
              <div class="requirement" id="length-check">
                <span class="check-icon">‚óã</span>
                <span>√çt nh·∫•t 8 k√Ω t·ª±</span>
              </div>
              <div class="requirement" id="case-check">
                <span class="check-icon">‚óã</span>
                <span>Ch·ªØ hoa v√† ch·ªØ th∆∞·ªùng</span>
              </div>
              <div class="requirement" id="number-check">
                <span class="check-icon">‚óã</span>
                <span>√çt nh·∫•t 1 s·ªë</span>
              </div>
              <div class="requirement" id="special-check">
                <span class="check-icon">‚óã</span>
                <span>√çt nh·∫•t 1 k√Ω t·ª± ƒë·∫∑c bi·ªát</span>
              </div>
            </div>
          </div>

          <button type="submit" class="submit-btn">
            <span>ƒê·ªïi M·∫≠t Kh·∫©u</span>
            <span class="btn-arrow">‚Üí</span>
          </button>

          <a href="#" class="back-link" id="backToProfile">
            <span>‚Üê</span> Quay l·∫°i H·ªì S∆°
          </a>
        </form>
      </div>
    </div>

    <script>
      // X√°c ƒë·ªãnh trang profile d·ª±a tr√™n role t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const role = urlParams.get("role") || "user";
      const backLink = document.getElementById("backToProfile");
      if (backLink) {
        backLink.href =
          role === "admin" ? "admin-profile.html" : "profile.html";
      }

      const newPasswordInput = document.getElementById("new-password");
      const requirements = {
        length: document.getElementById("length-check"),
        case: document.getElementById("case-check"),
        number: document.getElementById("number-check"),
        special: document.getElementById("special-check"),
      };

      newPasswordInput.addEventListener("input", function () {
        const password = this.value;

        // Length check
        updateRequirement(requirements.length, password.length >= 8);

        // Case check
        updateRequirement(
          requirements.case,
          /[a-z]/.test(password) && /[A-Z]/.test(password),
        );

        // Number check
        updateRequirement(requirements.number, /\d/.test(password));

        // Special character check
        updateRequirement(
          requirements.special,
          /[!@#$%^&*(),.?":{}|<>]/.test(password),
        );
      });

      function updateRequirement(element, isValid) {
        const icon = element.querySelector(".check-icon");
        if (isValid) {
          element.classList.add("valid");
          icon.textContent = "‚úì";
        } else {
          element.classList.remove("valid");
          icon.textContent = "‚óã";
        }
      }

      document
        .getElementById("changePasswordForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const currentPassword =
            document.getElementById("current-password").value;
          const newPassword = document.getElementById("new-password").value;
          const confirmPassword =
            document.getElementById("confirm-password").value;
          const submitBtn = this.querySelector(".submit-btn");

          if (!currentPassword || !newPassword || !confirmPassword) {
            alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin");
            return;
          }

          if (newPassword !== confirmPassword) {
            alert("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp");
            return;
          }

          if (newPassword.length < 8) {
            alert("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±");
            return;
          }

          if (!/[a-z]/.test(newPassword) || !/[A-Z]/.test(newPassword)) {
            alert("M·∫≠t kh·∫©u ph·∫£i c√≥ ch·ªØ hoa v√† ch·ªØ th∆∞·ªùng");
            return;
          }

          if (!/\d/.test(newPassword)) {
            alert("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 1 s·ªë");
            return;
          }

          if (!/[!@#$%^&*(),.?":{}|<>]/.test(newPassword)) {
            alert("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 1 k√Ω t·ª± ƒë·∫∑c bi·ªát");
            return;
          }

          // G·ªçi API ƒë·ªïi m·∫≠t kh·∫©u
          try {
            submitBtn.disabled = true;
            submitBtn.style.opacity = "0.6";
            submitBtn.innerHTML = "<span>ƒêang x·ª≠ l√Ω...</span>";

            const token = localStorage.getItem("authToken");
            if (!token) {
              alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i");
              window.location.href = "login.html";
              return;
            }

            const response = await fetch(
              "http://localhost:5000/api/auth/change-password",
              {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({
                  currentPassword,
                  newPassword,
                }),
              },
            );

            const data = await response.json();

            if (data.success) {
              alert("ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!");
              // Quay v·ªÅ trang profile t∆∞∆°ng ·ª©ng v·ªõi role
              const urlParams = new URLSearchParams(window.location.search);
              const role = urlParams.get("role") || "user";
              window.location.href =
                role === "admin" ? "admin-profile.html" : "profile.html";
            } else {
              alert(data.message || "ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i");
              submitBtn.disabled = false;
              submitBtn.style.opacity = "1";
              submitBtn.innerHTML =
                '<span>ƒê·ªïi M·∫≠t Kh·∫©u</span><span class="btn-arrow">‚Üí</span>';
            }
          } catch (error) {
            console.error("Error:", error);
            alert("ƒê√£ c√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i");
            submitBtn.disabled = false;
            submitBtn.style.opacity = "1";
            submitBtn.innerHTML =
              '<span>ƒê·ªïi M·∫≠t Kh·∫©u</span><span class="btn-arrow">‚Üí</span>';
          }
        });
    </script>

    <!-- Footer Component -->
<footer class="footer">
  <div class="footer-container">
    <!-- Footer Top -->
    <div class="footer-top">
      <!-- Brand Section -->
      <div class="footer-section footer-brand">
        <div class="footer-logo">
          <img
            src="../icon/logo.png"
            alt="Ether Lottery"
            class="footer-logo-img"
          />
          <h3>Ether Lottery</h3>
        </div>
        <p class="footer-description">
          Tr√≤ ch∆°i x·ªï s·ªë blockchain an to√†n, minh b·∫°ch v√† c√¥ng b·∫±ng. C∆° h·ªôi
          tr√∫ng th∆∞·ªüng l·ªõn v·ªõi c√¥ng ngh·ªá Web3.
        </p>
        <!-- Social Links -->
        <div class="footer-socials">
          <a href="#" class="social-link" title="Twitter">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2s9 5 20 5a9.5 9.5 0 00-9-5.5c4.75 2.25 7-7 7-7a5.5 5.5 0 01-4.3 2.1z"
              />
            </svg>
          </a>
          <a href="#" class="social-link" title="Discord">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M21 16.5c0 .828-.504 2.907-2.622 5.646-1.193 1.543-2.565 2.543-3.915 2.543-.787 0-1.285-.39-2.047-.9-.971-.66-1.876-.9-2.916-.9-1.04 0-1.945.24-2.916.9-.762.51-1.26.9-2.047.9-1.35 0-2.722-1-3.915-2.543C3.504 19.407 3 17.328 3 16.5 3 9.097 8.627 3 15.5 3c3.584 0 6.793 1.667 8.5 4.333"
              />
            </svg>
          </a>
          <a href="#" class="social-link" title="Telegram">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M21.198 2.433a1.5 1.5 0 00-1.798.278L3.5 17.613v3.387H7l14.902-16.5a1.5 1.5 0 00-1.304-2.467z"
              />
            </svg>
          </a>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="footer-section">
        <h4 class="footer-title">Li√™n K·∫øt Nhanh</h4>
        <ul class="footer-links">
          <li><a href="./index.html">Trang Ch·ªß</a></li>
          <li><a href="./profile.html">H·ªì S∆°</a></li>
          <li><a href="./notifications.html">Th√¥ng B√°o</a></li>
          <li><a href="./settings.html">C√†i ƒê·∫∑t</a></li>
        </ul>
      </div>

      <!-- Support -->
      <div class="footer-section">
        <h4 class="footer-title">H·ªó Tr·ª£</h4>
        <ul class="footer-links">
          <li><a href="#">C√¢u H·ªèi Th∆∞·ªùng G·∫∑p</a></li>
          <li><a href="#">Li√™n H·ªá</a></li>
          <li><a href="#">H∆∞·ªõng D·∫´n</a></li>
          <li><a href="#">Tr·ª£ Gi√∫p</a></li>
        </ul>
      </div>

      <!-- Legal -->
      <div class="footer-section">
        <h4 class="footer-title">Ph√°p L√Ω</h4>
        <ul class="footer-links">
          <li><a href="#">ƒêi·ªÅu Kho·∫£n D·ªãch V·ª•</a></li>
          <li><a href="#">Ch√≠nh S√°ch Ri√™ng T∆∞</a></li>
          <li><a href="#">Tuy√™n B·ªë Mi·ªÖn Tr√°ch</a></li>
          <li><a href="#">Ch∆°i C√≥ Tr√°ch Nhi·ªám</a></li>
        </ul>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <p class="copyright">
          &copy; 2024-2026 <strong>Ether Lottery</strong>. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o
          l∆∞u.
        </p>
        <p class="disclaimer">
          ‚ö†Ô∏è C·∫£nh b√°o: Tr√≤ ch∆°i n√†y ch·ªâ d√†nh cho ng∆∞·ªùi tr∆∞·ªüng th√†nh. Ch∆°i c√≥
          tr√°ch nhi·ªám.
        </p>
      </div>
      <div class="footer-status">
        <span class="status-item">
          <span class="status-dot"></span>
          Sepolia Testnet
        </span>
        <span class="status-item">
          <span class="status-dot active"></span>
          Tr·ª±c Tuy·∫øn
        </span>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>